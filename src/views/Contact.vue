<template>
    <div class="bg-home">
        <section class="bread-crumb" style="background-image: url('../assets/css/themes/breadcrumb-bg.webp')">
            <div class="container">
                <div class="title-breadcrumb">
                    Liên Hệ
                </div>
                <ul class="breadcrumb">
                    <li class="home">
                        <a href="index.html"><span>Trang chủ</span></a>
                        <span class="mr_lr">&nbsp;<svg aria-hidden="true" focusable="false" data-prefix="fas"
                                data-icon="chevron-right" role="img" xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 320 512" class="svg-inline--fa fa-chevron-right fa-w-10">
                                <path fill="currentColor"
                                    d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"
                                    class=""></path>
                            </svg>&nbsp;</span>
                    </li>
                    <li><strong><span>Liên Hệ</span></strong></li>
                </ul>
            </div>
        </section>
        <h1 class="title-head-contact a-left d-none">Liên hệ</h1>
        <div class="layout-contact">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-12">
                        <div id="contact_map" class="map">
                            <iframe
                                src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3723.904149430962!2d105.8133027759182!3d21.036520887510726!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3135ab1946cc7e23%3A0x87ab3917166a0cd5!2zUGjhuqduIG3hu4FtIHF14bqjbiBsw70gYsOhbiBow6BuZyAtIFNhcG8gUE9T!5e0!3m2!1svi!2s!4v1694162431115!5m2!1svi!2s"
                                width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                    </div>
                    <div class="col-lg-6 col-12">
                        <div class="contact">
                            <h4>LOFI Construction</h4>
                            <div class="time_work">
                                <div class="item">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas"
                                        data-icon="map-marker-alt" role="img" xmlns="http://www.w3.org/2000/svg"
                                        viewBox="0 0 384 512" class="svg-inline--fa fa-map-marker-alt fa-w-12">
                                        <path fill="currentColor"
                                            d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"
                                            class=""></path>
                                    </svg>
                                    <b>Địa chỉ:</b>

                                    266 Đội Cấn, Liễu Giai, Ba Đình, Hà Nội

                                </div>
                                <div class="item">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="envelope"
                                        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                        class="svg-inline--fa fa-envelope fa-w-16">
                                        <path fill="currentColor"
                                            d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"
                                            class=""></path>
                                    </svg>
                                    <b>Email:</b> <a href="mailto:support@sapo.vn"
                                        title="support@sapo.vn">support@sapo.vn</a>
                                </div>
                                <div class="item">
                                    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="phone-alt"
                                        role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"
                                        class="svg-inline--fa fa-phone-alt fa-w-16">
                                        <path fill="currentColor"
                                            d="M497.39 361.8l-112-48a24 24 0 0 0-28 6.9l-49.6 60.6A370.66 370.66 0 0 1 130.6 204.11l60.6-49.6a23.94 23.94 0 0 0 6.9-28l-48-112A24.16 24.16 0 0 0 122.6.61l-104 24A24 24 0 0 0 0 48c0 256.5 207.9 464 464 464a24 24 0 0 0 23.4-18.6l24-104a24.29 24.29 0 0 0-14.01-27.6z"
                                            class=""></path>
                                    </svg>
                                    <b>Hotline:</b> <a class="fone" href="tel:19006750" title="19006750">1900 6750</a>
                                </div>
                            </div>
                        </div>
                        <div class="form-contact">
                            <h4>Liên hệ với chúng tôi</h4>
                            <span class="content-form">
                                Nếu bạn có thắc mắc gì, có thể gửi yêu cầu cho chúng tôi, và chúng tôi sẽ liên lạc lại
                                với bạn sớm nhất có thể .
                            </span>
                            <div id="pagelogin">
                                <form @submit.prevent="submitForm" id="contact">
                                    <input type="hidden" name="FormType" value="contact" />
                                    <input type="hidden" name="utf8" value="true" />
                                    <input type="hidden" v-model="formData.token" name="Token" />

                                    <div class="group_contact">
                                        <input v-model="formData.name" placeholder="Họ và tên" type="text"
                                            class="form-control form-control-lg" required name="contact[Name]" />

                                        <input v-model="formData.email" placeholder="Email" type="email"
                                            pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$" required
                                            class="form-control form-control-lg" name="contact[email]" />

                                        <input v-model="formData.phone" type="number" placeholder="Điện thoại*"
                                            class="form-control form-control-lg" required name="contact[phone]" />

                                        <textarea v-model="formData.message" placeholder="Nội dung"
                                            class="form-control content-area form-control-lg" rows="5" required
                                            name="contact[body]"></textarea>

                                        <button type="submit" class="btn-lienhe" :disabled="loading">Gửi thông
                                            tin</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</template>

<script>
import axios from "axios";
export default {
    name: 'Contact',
    data() {
        return {
            formData: {
                name: "",
                email: "",
                phone: "",
                message: "",
                token: ""
            },
            loading: false
        };
    },
    mounted() {
        this.loadRecaptcha();
    },
    methods: {
        loadRecaptcha() {
            const recaptchaScript = document.createElement("script");
            recaptchaScript.src = "https://www.google.com/recaptcha/api.js?render=6Ldtu4IUAAAAAMQzG1gCw3wFlx_GytlZyLrXcsuK";
            recaptchaScript.async = true;
            recaptchaScript.defer = true;
            recaptchaScript.onload = () => {
                grecaptcha.ready(() => {
                    grecaptcha.execute("6Ldtu4IUAAAAAMQzG1gCw3wFlx_GytlZyLrXcsuK", { action: "contact" }).then((token) => {
                        this.formData.token = token;
                    });
                });
            };
            document.head.appendChild(recaptchaScript);
        },
        async submitForm() {
            if (!this.formData.token) {
                alert("Vui lòng chờ reCAPTCHA tải xong!");
                return;
            }

            this.loading = true;

            try {
                const response = await axios.post("https://lofi-company.mysapo.net/postcontact", this.formData, {
                    headers: { "Content-Type": "application/x-www-form-urlencoded" }
                });

                alert("Gửi thông tin thành công!");
                this.formData = { name: "", email: "", phone: "", message: "", token: "" };
                this.loadRecaptcha(); // Refresh token sau khi gửi
            } catch (error) {
                console.error("Lỗi gửi form:", error);
                alert("Gửi thông tin thất bại!");
            } finally {
                this.loading = false;
            }
        }
    }
};
</script>